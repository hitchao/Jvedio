<super:BaseWindow
    x:Class="Jvedio.Main"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cmd="clr-namespace:Jvedio.Core.Command"
    xmlns:config="clr-namespace:Jvedio;assembly=Jvedio"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Jvedio"
    xmlns:localControl="clr-namespace:Jvedio.Core.UserControls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:super="https://github.com/SuperStudio/SuperControls"
    Title="{DynamicResource AppTitle}"
    Width="1200"
    Height="700"
    MinWidth="800"
    MinHeight="500"
    Background="{DynamicResource Window.Background}"
    CloseToTaskBar="{Binding CloseToTaskBar, Source={x:Static config:ConfigManager.Settings}, Mode=OneWay}"
    Closed="Window_Closed"
    Closing="Window_Closing"
    ContentRendered="Window_ContentRendered"
    DataContext="{Binding ElementName=main}"
    Foreground="{DynamicResource Window.Foreground}"
    Icon="pack://application:,,,/Resources/Jvedio.ico"
    Loaded="BaseWindow_Loaded"
    PreviewKeyUp="Window_PreviewKeyUp"
    ShowThemeSelector="True"
    TitleAlign="Left"
    TitleHeight="30"
    TitleMargin="5 0"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">


    <super:BaseWindow.Resources>

        <Style
            x:Key="HelloPageButton"
            BasedOn="{StaticResource FlatButton}"
            TargetType="Button">
            <Setter Property="Width" Value="80" />
            <Setter Property="Height" Value="70" />
            <Setter Property="super:CommonExt.CornerRadius" Value="5" />
            <Setter Property="super:CommonExt.HoverBackground" Value="{DynamicResource Button.Hover.Background}" />
        </Style>



        <Style x:Key="ItemsControlVirtualizedStyle" TargetType="ItemsControl">
            <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True" />
            <Setter Property="ScrollViewer.CanContentScroll" Value="True" />
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ItemsControl">
                        <Border
                            Padding="{TemplateBinding Control.Padding}"
                            Background="{TemplateBinding Panel.Background}"
                            BorderBrush="{TemplateBinding Border.BorderBrush}"
                            BorderThickness="{TemplateBinding Border.BorderThickness}"
                            SnapsToDevicePixels="True">
                            <ScrollViewer Padding="{TemplateBinding Control.Padding}" Focusable="False">
                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>



        <ContextMenu x:Key="TextBlockContextMenu">
            <MenuItem Click="CopyTextBlock" Header="{DynamicResource Copy}" />
        </ContextMenu>


        <Style
            x:Key="MyListBoxItemStyle"
            BasedOn="{StaticResource NormalListBoxItem}"
            TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10,5" />
        </Style>




        <Style
            x:Key="InfoItemStyle"
            BasedOn="{StaticResource FlatListBoxItem}"
            TargetType="{x:Type ListBoxItem}">
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Background" Value="Red" />
            <!--<Setter Property="ContentTemplate" Value="{StaticResource ListTemplate}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}, Path=DataContext.Tile, FallbackValue=False}" Value="True">
                    <Setter Property="ContentTemplate" Value="{StaticResource TileTemplate}" />
                </DataTrigger>
            </Style.Triggers>-->
        </Style>

        <Style
            x:Key="ActorInfoTextBlock"
            BasedOn="{StaticResource BaseTextBlock}"
            TargetType="{x:Type TextBlock}">
            <Setter Property="Margin" Value="10,10" />
        </Style>


        <Style
            x:Key="ActorTextBox"
            BasedOn="{StaticResource ReadOnlyWrapTextBox}"
            TargetType="{x:Type TextBox}">
            <Setter Property="Width" Value="100" />
            <Setter Property="TextAlignment" Value="Left" />
            <Setter Property="FontSize" Value="15" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="ContextMenu" Value="{StaticResource TextBoxContextMenu}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding EnableEditActress}" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Window.Side.Background}" />
                    <Setter Property="IsReadOnly" Value="False" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style
            x:Key="MenuButton"
            BasedOn="{StaticResource HoverButton}"
            TargetType="{x:Type Button}">
            <Setter Property="Height" Value="40" />
        </Style>

        <Style
            x:Key="CenterTextBlock"
            BasedOn="{StaticResource BaseTextBlock}"
            TargetType="{x:Type TextBlock}">
            <Setter Property="Padding" Value="5" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="FontSize" Value="20" />
        </Style>




        <ContextMenu
            x:Key="SettingsContextMenu"
            Panel.ZIndex="7"
            HorizontalOffset="-45"
            VerticalOffset="-5">
            <MenuItem
                Click="ShowSettingsWindow"
                Header="{DynamicResource Settings}"
                Icon="/Resources/Picture/setting.png" />
            <MenuItem Click="ShowPluginWindow" Header="{DynamicResource Plugin}" />
            <MenuItem Header="{DynamicResource Scan}">
                <MenuItem
                    Command="{Binding AddNewMovie}"
                    Header="{DynamicResource ID}"
                    Icon="/Resources/Picture/新增.png"
                    Visibility="{Binding Path=TeenMode, Source={x:Static config:ConfigManager.Settings}, Converter={StaticResource BoolToOppositeVisibilityConverter}}" />
                <MenuItem Click="ImportVideoByPaths" Header="{DynamicResource ScanMultiDir}" />
                <MenuItem Click="ImportVideo" Header="{DynamicResource ScanNas}" />
            </MenuItem>

            <MenuItem Header="高级">
                <MenuItem Click="ManageDataBase" Header="{DynamicResource MovieManagement}" />
                <MenuItem Click="OpenServer" Header="后台服务管理" />
                <MenuItem Click="ClearCache" Header="清空缓存" />
            </MenuItem>


            <MenuItem Header="Jvedio">

                <MenuItem
                    Click="ShowAbout"
                    Header="{DynamicResource About}"
                    Icon="/Resources/Picture/about.png" />
                <MenuItem Click="OpenHelp" Header="{DynamicResource Help}" />
                <MenuItem Click="OpenFeedBack" Header="{DynamicResource FeedBack}" />
                <MenuItem Click="OpenJvedioWebPage" Header="{DynamicResource WebSite}" />
            </MenuItem>


            <MenuItem Header="{DynamicResource OpenPath}">
                <MenuItem Click="OpenLogPath" Header="{DynamicResource Log}" />
                <MenuItem Click="OpenImageSavePath" Header="{DynamicResource Picture}" />
                <MenuItem Click="OpenApplicationPath" Header="{DynamicResource SoftWare}" />
            </MenuItem>

            <MenuItem
                Click="ShowUpgradeWindow"
                Header="{DynamicResource CheckUpgrade}"
                Icon="/Resources/Picture/update.png" />

        </ContextMenu>

        <Style
            x:Key="NotifyButtonStyle"
            BasedOn="{StaticResource FlatButton}"
            TargetType="Button">
            <Setter Property="Margin" Value="5,0" />
            <Setter Property="Padding" Value="30,10" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="super:CommonExt.HoverBackground" Value="{DynamicResource Menu.Hover.Background}" />
        </Style>

    </super:BaseWindow.Resources>
    <Grid AllowDrop="True">
        <!--  托盘图标  -->
        <Popup
            x:Name="notiIconPopup"
            Width="auto"
            Height="auto"
            AllowsTransparency="True"
            HorizontalOffset="-5"
            Placement="MousePoint"
            PopupAnimation="Fade"
            StaysOpen="False"
            VerticalOffset="-5">
            <Grid Margin="5">
                <Border
                    Margin="5"
                    Background="{DynamicResource Menu.Background}"
                    CornerRadius="2"
                    Effect="{StaticResource PopupDropShadowEffect}" />

                <StackPanel Margin="0,10" Orientation="Vertical">
                    <Button
                        Click="ShowMainWindow"
                        Content="{DynamicResource OpenJvedio}"
                        Style="{StaticResource NotifyButtonStyle}" />
                    <Button
                        Click="ShowSettingsWindow"
                        Content="{DynamicResource Settings}"
                        Style="{StaticResource NotifyButtonStyle}" />
                    <Button
                        Click="ShowUpgradeWindow"
                        Content="{DynamicResource CheckUpgrade}"
                        Style="{StaticResource NotifyButtonStyle}" />
                    <Button
                        Click="ShowAbout"
                        Content="{DynamicResource About}"
                        Style="{StaticResource NotifyButtonStyle}" />
                    <Button
                        super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Deep.Background}"
                        Click="Notify_Close"
                        Content="{DynamicResource Exit}"
                        Style="{StaticResource NotifyButtonStyle}" />

                </StackPanel>

            </Grid>
        </Popup>

        <Grid Panel.ZIndex="5" Visibility="{Binding Waiting, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Hidden}">
            <Border Background="{DynamicResource Window.Detail.Background}" Opacity="0.5" />
            <Border
                Width="200"
                Height="200"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Effect="{StaticResource PopupDropShadowEffect}"
                Style="{StaticResource InfoBorder}" />
            <StackPanel
                Margin="50"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Orientation="Vertical">
                <super:LoadingLine
                    Width="100"
                    Height="30"
                    Margin="20" />
                <TextBlock Style="{StaticResource BaseTextBlock}" Text="{Binding WaitingMsg}" />
            </StackPanel>
        </Grid>

        <Grid Margin="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Name="SideGridColumn"
                            Width="{Binding SideGridWidth, FallbackValue=200, Mode=OneWay}"
                            MaxWidth="500" />
                        <ColumnDefinition Width="5" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <!--  侧边栏  -->
                    <Border
                        Grid.Column="0"
                        Background="{DynamicResource Window.Side.Background}"
                        SizeChanged="SideBorder_SizeChanged">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <super:HoverPath
                                    Click="GoToStartUp"
                                    Style="{StaticResource HomeHoverPath}"
                                    ToolTip="{DynamicResource Return}" />


                                <ComboBox
                                    Grid.Column="1"
                                    DisplayMemberPath="Name"
                                    ItemsSource="{Binding DataBases}"
                                    SelectedIndex="{Binding CurrentDbId, Mode=OneWay}"
                                    SelectedValuePath="DBId"
                                    SelectionChanged="DatabaseComboBox_SelectionChanged"
                                    Style="{StaticResource RoundComboBox}"
                                    ToolTip="{Binding RelativeSource={RelativeSource Mode=Self}, Path=Text}" />
                            </Grid>

                            <Border x:Name="sideMenuContainer" Grid.Row="1">
                                <localControl:VideoSideMenu />
                            </Border>

                            <Grid
                                Grid.Row="2"
                                Margin="0,0,5,5"
                                VerticalAlignment="Bottom">
                                <Image
                                    Height="20"
                                    Margin="20,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Source="/Resources/Picture/Title.png"
                                    ToolTip="Jvedio" />

                                <super:HoverPath
                                    Width="30"
                                    Height="30"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    ContextMenu="{StaticResource SettingsContextMenu}"
                                    Style="{StaticResource SettingHoverPath}"
                                    ToolTip="{DynamicResource Settings}" />
                            </Grid>
                        </Grid>

                    </Border>

                    <!--  左右调节  -->
                    <GridSplitter
                        Grid.Column="1"
                        Width="4"
                        HorizontalAlignment="Left"
                        Panel.ZIndex="10"
                        Style="{StaticResource HoverSpliter}" />


                    <Grid
                        Grid.Column="2"
                        AllowDrop="True"
                        Background="Transparent"
                        DragLeave="OnDragFileLeave"
                        DragOver="OnDragFileOver"
                        Drop="OnDragFileDrop">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <super:NoticeViewer x:Name="noticeViewer" Grid.Row="0" />

                        <!--  logo  -->
                        <Grid Grid.Row="1" Visibility="{Binding ShowSoft, Converter={StaticResource BoolToVisibilityConverter}}">

                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>

                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                                <Image
                                    Grid.Row="0"
                                    Height="96"
                                    Source="pack://application:,,,/Resources/Picture/Jvedio.png">
                                    <Image.Effect>
                                        <DropShadowEffect
                                            BlurRadius="4"
                                            Direction="315"
                                            Opacity="1"
                                            ShadowDepth="5" />
                                    </Image.Effect>
                                </Image>
                                <TextBlock
                                    Grid.Row="1"
                                    Margin="20"
                                    FontFamily="楷体"
                                    FontSize="25"
                                    FontWeight="Bold"
                                    Style="{StaticResource BaseTextBlock}"
                                    Text="{DynamicResource ThanksUseJvedio}">
                                    <TextBlock.Effect>
                                        <DropShadowEffect
                                            BlurRadius="4"
                                            Direction="315"
                                            Opacity="1"
                                            ShadowDepth="5" />
                                    </TextBlock.Effect>
                                </TextBlock>

                                <StackPanel
                                    Grid.Row="1"
                                    HorizontalAlignment="Center"
                                    Orientation="Horizontal">
                                    <Button
                                        Width="150"
                                        Margin="20"
                                        Padding="10,15"
                                        super:CommonExt.BorderThickness="2"
                                        BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                        Click="ImportVideo"
                                        Style="{StaticResource BorderButton}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image
                                                Height="13"
                                                Margin="0,0,5,0"
                                                Source="/Resources/Picture/导入.png" />
                                            <TextBlock Margin="5,0" Text="{DynamicResource ImportVideo}" />
                                        </StackPanel>
                                    </Button>
                                    <Button
                                        Width="150"
                                        Margin="20"
                                        Padding="10,15"
                                        super:CommonExt.BorderThickness="2"
                                        BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                        Command="{Binding AddNewMovie}"
                                        Style="{StaticResource BorderButton}"
                                        Visibility="{Binding Path=TeenMode, Source={x:Static config:ConfigManager.Settings}, Converter={StaticResource BoolToOppositeVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image
                                                Height="13"
                                                Margin="0,0,5,0"
                                                Source="/Resources/Picture/新增.png" />
                                            <TextBlock Margin="5,0" Text="{DynamicResource ID}" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>




                            </StackPanel>

                            <StackPanel
                                Margin="70"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Bottom"
                                Orientation="Horizontal">
                                <Button Click="GoToStartUp" Style="{StaticResource HelloPageButton}">
                                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                                        <Viewbox
                                            Width="20"
                                            Height="auto"
                                            Margin="5"
                                            VerticalAlignment="Center">
                                            <Path
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Data="{StaticResource GeoHome}"
                                                Fill="{DynamicResource Window.Foreground}" />
                                        </Viewbox>
                                        <TextBlock
                                            Margin="5"
                                            HorizontalAlignment="Center"
                                            Text="{DynamicResource Library}" />
                                    </StackPanel>
                                </Button>

                                <Button
                                    Command="{Binding SideButtonCmd}"
                                    CommandParameter="All"
                                    Style="{StaticResource HelloPageButton}">
                                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                                        <Viewbox
                                            Width="20"
                                            Height="auto"
                                            Margin="5"
                                            VerticalAlignment="Center">
                                            <Path
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Data="{StaticResource GeoVideo}"
                                                Fill="{DynamicResource Window.Foreground}" />
                                        </Viewbox>
                                        <TextBlock
                                            Margin="5"
                                            HorizontalAlignment="Center"
                                            Text="{DynamicResource AllVideo}" />
                                    </StackPanel>

                                </Button>
                                <Button
                                    Command="{Binding SideButtonCmd}"
                                    CommandParameter="Actor"
                                    Style="{StaticResource HelloPageButton}">
                                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                                        <Viewbox
                                            Width="20"
                                            Height="auto"
                                            Margin="5"
                                            VerticalAlignment="Center">
                                            <Path
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Data="{StaticResource GeoActor}"
                                                Fill="{DynamicResource Window.Foreground}" />
                                        </Viewbox>
                                        <TextBlock
                                            Margin="5"
                                            HorizontalAlignment="Center"
                                            Text="{DynamicResource Actors}" />
                                    </StackPanel>

                                </Button>
                                <Button Click="ShowSettingsWindow" Style="{StaticResource HelloPageButton}">
                                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                                        <Viewbox
                                            Width="20"
                                            Height="auto"
                                            Margin="5"
                                            VerticalAlignment="Center">
                                            <Path
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Data="{StaticResource GeoSetting}"
                                                Fill="{DynamicResource Window.Foreground}" />
                                        </Viewbox>
                                        <TextBlock
                                            Margin="5"
                                            HorizontalAlignment="Center"
                                            Text="{DynamicResource Settings}" />
                                    </StackPanel>

                                </Button>
                            </StackPanel>

                            <TextBlock
                                Grid.Row="2"
                                Margin="20"
                                VerticalAlignment="Bottom"
                                FontSize="12"
                                Foreground="{DynamicResource Window.Sub.Foreground}"
                                Style="{StaticResource BaseTextBlock}"
                                Text="@Jvedio Copyright © 2020">
                                <TextBlock.Effect>
                                    <DropShadowEffect
                                        BlurRadius="4"
                                        Direction="315"
                                        Opacity="1"
                                        ShadowDepth="5"
                                        Color="Black" />
                                </TextBlock.Effect>
                            </TextBlock>
                        </Grid>
                        <Grid Grid.Row="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <!--  选项 tabitem 栏  -->
                            <ScrollViewer
                                Grid.Row="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top"
                                HorizontalScrollBarVisibility="Auto"
                                PreviewMouseWheel="Tab_PreviewMouseWheel"
                                Style="{StaticResource FloatScrollViewer}"
                                VerticalScrollBarVisibility="Hidden">
                                <ItemsControl
                                    Name="tabItemsControl"
                                    AlternationCount="999"
                                    ItemsSource="{Binding TabItems}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Background="Transparent" Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Height="30"
                                                MinWidth="150"
                                                BorderThickness="0"
                                                ContextMenuOpening="Border_ContextMenuOpening"
                                                CornerRadius="5 5 0 0"
                                                Cursor="Hand"
                                                PreviewMouseLeftButtonDown="BeginDragTabItem"
                                                PreviewMouseLeftButtonUp="SetTabSelected"
                                                PreviewMouseMove="Border_PreviewMouseMove"
                                                Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=(ItemsControl.AlternationIndex)}">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="{DynamicResource TabItem.Background}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource ListBoxItem.Selected.Active.BorderBrush}" />
                                                            </Trigger>
                                                            <DataTrigger Binding="{Binding Selected}" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource ListBoxItem.Selected.Active.Background}" />
                                                            </DataTrigger>

                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Border.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem
                                                            Click="RefreshCurrentTab"
                                                            Header="{DynamicResource Refresh}"
                                                            Icon="pack://application:,,,/Resources/Picture/refresh.png" />
                                                        <MenuItem
                                                            Click="CloseCurrentTab"
                                                            Header="{DynamicResource Close}"
                                                            Icon="pack://application:,,,/Resources/Picture/status_fail.png" />
                                                        <MenuItem Click="CloseOtherTab" Header="{DynamicResource CloseOther}" />
                                                        <MenuItem Click="CloseAllLeftTab" Header="{DynamicResource CloseAllLeft}" />
                                                        <MenuItem Click="CloseAllRightTab" Header="{DynamicResource CloseAllRight}" />
                                                        <MenuItem Click="CloseAllTabs" Header="{DynamicResource CloseAll}" />
                                                        <Separator />
                                                        <MenuItem Click="MoveToFirst" Header="{DynamicResource MoveToFirst}" />
                                                        <MenuItem Click="MoveToLast" Header="{DynamicResource MoveToLast}" />
                                                        <Separator />
                                                        <MenuItem
                                                            Click="PinTab"
                                                            Header="固定"
                                                            Icon="pack://application:,,,/Resources/Picture/pinned.png"
                                                            IsCheckable="True"
                                                            IsChecked="{Binding Pinned, Mode=OneWay}" />
                                                    </ContextMenu>
                                                </Border.ContextMenu>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="30" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <super:LoadingCircle
                                                        Grid.Column="0"
                                                        Width="17"
                                                        Height="17"
                                                        Margin="5"
                                                        DotSize="3"
                                                        Visibility="{Binding Loading, Converter={StaticResource BoolToVisibilityConverter}}" />

                                                    <Viewbox
                                                        Grid.Column="0"
                                                        Width="15"
                                                        Height="15"
                                                        Margin="5"
                                                        Visibility="{Binding Loading, Converter={StaticResource BoolToOppositeVisibilityConverter}}">
                                                        <Path Data="{Binding TabGeometry}" Fill="{DynamicResource Window.Foreground}" />
                                                    </Viewbox>
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        MaxWidth="200"
                                                        Margin="0"
                                                        Padding="10,5"
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{Binding Name}"
                                                        TextAlignment="Left"
                                                        TextTrimming="WordEllipsis"
                                                        TextWrapping="WrapWithOverflow" />

                                                    <Grid Grid.Column="3">
                                                        <super:HoverPath
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5"
                                                            VerticalAlignment="Center"
                                                            Panel.ZIndex="2"
                                                            PreviewMouseLeftButtonDown="PinTab"
                                                            Style="{StaticResource PinHoverPath}"
                                                            Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=(ItemsControl.AlternationIndex)}"
                                                            Visibility="{Binding Pinned, Converter={StaticResource BoolToVisibilityConverter}}" />


                                                        <super:HoverPath
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5"
                                                            VerticalAlignment="Center"
                                                            super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                            PreviewMouseLeftButtonDown="CloseTabItem"
                                                            Style="{StaticResource CloseExHoverPath}"
                                                            Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=(ItemsControl.AlternationIndex)}"
                                                            Visibility="{Binding Pinned, Converter={StaticResource BoolToOppositeVisibilityConverter}}" />

                                                    </Grid>


                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <!--  动态新增内容  -->
                            <super:SimplePanel x:Name="TabDataPanel" Grid.Row="1" />

                        </Grid>

                        <!--  拖入视频时显示  -->
                        <super:SimplePanel
                            Grid.Row="1"
                            Margin="5,0"
                            Panel.ZIndex="99"
                            DragEnter="OnDragFileOver"
                            Visibility="{Binding DragInFile, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Hidden}">
                            <Border
                                Background="{DynamicResource Window.Title.Background}"
                                CornerRadius="5"
                                Effect="{StaticResource NormalDropShadowEffect}"
                                Opacity="0.5"
                                PreviewDragLeave="OnDragFileLeave" />

                            <Border
                                Width="220"
                                Height="220"
                                Padding="20"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                CornerRadius="5"
                                Style="{StaticResource InfoBorder}">
                                <StackPanel
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Background="Transparent"
                                    Orientation="Vertical">
                                    <Image
                                        Height="40"
                                        Margin="10,30"
                                        Source="/Resources/Picture/导入_128.png" />
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="{DynamicResource ImportVideo}" />
                                </StackPanel>

                            </Border>


                        </super:SimplePanel>


                    </Grid>


                </Grid>

                <!--  首次运行显示扫描  -->
                <super:SimplePanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Panel.ZIndex="10"
                    Visibility="{Binding ShowFirstRun, FallbackValue=Hidden}">
                    <super:SimplePanel>
                        <Border
                            Margin="5"
                            Background="{DynamicResource Window.Foreground}"
                            CornerRadius="5"
                            Effect="{StaticResource NormalBlurEffect}" />

                        <Border
                            Margin="5"
                            Background="{DynamicResource Window.InnerDialog.Background}"
                            CornerRadius="5">

                            <StackPanel
                                Margin="40"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Panel.ZIndex="1"
                                FocusVisualStyle="{x:Null}"
                                Orientation="Horizontal"
                                Visibility="Visible">
                                <TextBlock
                                    Margin="20,0"
                                    VerticalAlignment="Center"
                                    FontSize="20"
                                    Style="{StaticResource BaseTextBlock}"
                                    Text="{DynamicResource DragFileInOr}" />
                                <Button Click="ImportVideo" Content="{DynamicResource Scan}" />
                            </StackPanel>
                        </Border>
                    </super:SimplePanel>

                    <super:HoverPath Click="HideBeginScanGrid" Style="{StaticResource CloseExHoverPath}" />
                </super:SimplePanel>

            </Grid>
            <Grid
                Grid.Row="1"
                Height="30"
                Background="{DynamicResource Window.StatusBar.Background}"
                Visibility="{Binding DisplayStatusBar, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay, Source={x:Static config:ConfigManager.Main}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <super:SysInfo />
                <StackPanel
                    Grid.Column="2"
                    Margin="5,0"
                    Orientation="Horizontal">
                    <Grid
                        Width="30"
                        MouseLeftButtonUp="OpenServerWindow"
                        Visibility="Collapsed">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Cursor" Value="Hand" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource Window.StatusBar.Hover.Background}" />
                                    </Trigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="UnReady">
                                        <Setter Property="ToolTip" Value="后台服务未就绪" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="Starting">
                                        <Setter Property="ToolTip" Value="后台服务启动中" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="Ready">
                                        <Setter Property="ToolTip" Value="后台服务已就绪" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Viewbox
                            Width="20"
                            Height="18"
                            VerticalAlignment="Center">
                            <Path Data="M896 767H129c-35.3 0-64-28.7-64-64V128.3c0-35.3 28.7-64 64-64h767c35.3 0 64 28.7 64 64V703c0 35.3-28.7 64-64 64z m-766.9-64H896l0.1-0.1V128.4l-0.1-0.1H129.1l-0.1 0.1 0.1 574.6c-0.1 0-0.1 0 0 0z M383.1 592h-0.1c-27.5-0.1-41.8-27.8-48.8-41.2-8.1-15.6-16.4-35.9-24.5-55.5-6.4-15.6-13.1-31.7-19.3-44.7-2.3-4.8-4.2-8.6-5.9-11.6-4.8 3.8-11.3 9.9-19.8 19.4-11.8 13.2-20.5 25.3-20.6 25.4-10.3 14.4-30.3 17.7-44.6 7.4-14.4-10.3-17.7-30.3-7.4-44.6 0.5-0.7 12.8-17.9 28.9-35.2 26.7-28.8 49.1-42.2 70.3-42.4h0.3c13.1 0 25 6.2 35.3 18.4 5.1 6.1 10.3 14.1 15.7 24.5 8.8 16.8 17.7 38.3 26.2 59 3.7 9 8.9 21.6 14.1 33.3 8.3-17.2 17.6-38.2 24.5-53.5C451.2 352.3 473.9 305 511.6 305c34.4 0 63 34.2 105.9 90.5 7.4 9.7 17.3 22.7 24.9 31.6 11.1-9.8 33-32.8 72.2-85.5 32.6-43.8 60.5-85.9 60.8-86.3 9.7-14.7 29.6-18.8 44.3-9 14.7 9.7 18.8 29.6 9 44.3-1.3 2-32.7 49.4-69.2 97.7-21.7 28.8-40.8 52-56.5 68.7-26.8 28.5-45.3 40.1-63.9 40.1-17.9 0-31.3-12.5-43.2-25.9-8.9-10.1-18.8-23.1-29.4-37-11.9-15.6-24.2-31.8-35.9-44.9-6.2-7-11-11.7-14.5-14.8-3.8 5.6-9.1 14.6-16.3 28.8-11 21.6-22.7 47.9-34 73.3-11.5 25.8-22.3 50.1-32 68.8-5.8 11.2-10.7 19.3-15.3 25.6-3.8 5.3-15.5 21-35.4 21z m249.8-157.7z m-338.7-1.6z m213.5-64.3zM512.1 846.7c-38 0-74.1-7.6-101.7-21.4-33.1-16.5-51.3-40.5-51.3-67.6 0-13.8 11.2-25 25-25s25 11.2 25 25c0 13.7 39.1 38.9 103 38.9s103-25.2 103-38.9c0-13.8 11.2-25 25-25s25 11.2 25 25c0 27-18.2 51-51.3 67.6-27.6 13.8-63.7 21.4-101.7 21.4zM161 960c-17.7 0-32-14.3-32-32s14.3-32 32-32l703.4-0.7c17.7 0 32 14.3 32 32s-14.3 32-32 32L161 960z" Fill="{DynamicResource Window.Foreground}" />
                        </Viewbox>

                        <Border
                            Width="10"
                            Height="10"
                            Margin="2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            CornerRadius="5">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="Gray" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ServerStatus}" Value="UnReady">
                                            <Setter Property="Background" Value="Gray" />

                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ServerStatus}" Value="Starting">
                                            <Setter Property="Background" Value="{DynamicResource Common.HighLight.Deep.Background}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ServerStatus}" Value="Ready">
                                            <Setter Property="Background" Value="{DynamicResource CheckBox.Checked.Background}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>

                    </Grid>
                    <super:PathMsg
                        MouseLeftButtonUp="ShowScreenShotTab"
                        MsgCount="{Binding RunningCount, Source={x:Static local:App.ScreenShotManager}, Mode=OneWay}"
                        Path="M443.972267 437.316267L200.157867 117.3504a39.355733 39.355733 0 0 1 5.5296-53.6576 36.4544 36.4544 0 0 1 51.8144 3.754667l254.088533 291.908266 254.0544-291.9424a36.932267 36.932267 0 0 1 51.882667-3.754666 39.287467 39.287467 0 0 1 5.597866 53.76l-243.8144 319.931733 151.381334 174.1824a185.002667 185.002667 0 0 1 223.675733 81.749333 184.0128 184.0128 0 0 1-43.008 233.984 184.388267 184.388267 0 0 1-237.704533-2.7648 183.978667 183.978667 0 0 1-37.341867-234.973866 32.768 32.768 0 0 1-3.754667-4.608l-120.968533-158.378667-67.6864-89.1904 0.068267-0.034133z m-49.493334 57.002666l70.929067 92.8768-74.205867 97.621334c-1.4336 1.365333-2.389333 3.310933-3.754666 4.676266a184.490667 184.490667 0 0 1-275.114667 237.738667 184.558933 184.558933 0 0 1 180.736-315.733333l101.376-117.213867zM240.776533 894.976a110.011733 110.011733 0 0 0 91.5456-64.443733 111.616 111.616 0 0 0-11.707733-111.616 111.5136 111.5136 0 0 0-102.7072-44.373334 110.523733 110.523733 0 0 0-96.221867 121.4464 110.045867 110.045867 0 0 0 119.0912 98.986667z m541.7984 0a110.421333 110.421333 0 0 0 102.7072-44.3392 110.660267 110.660267 0 0 0-25.258666-155.921067 110.011733 110.011733 0 0 0-54.613334-19.729066 110.455467 110.455467 0 0 0-119.534933 98.542933 111.274667 111.274667 0 0 0 96.699733 121.4464z"
                        Style="{StaticResource NormalPathMsg}" />
                    <Grid>

                        <Border
                            Name="msgScan"
                            Width="30"
                            Height="30"
                            Margin="0"
                            MouseLeftButtonUp="ShowMsgScanPopup">
                            <Border.Style>
                                <Style BasedOn="{StaticResource FlatBorderStyle}" TargetType="Border">
                                    <Setter Property="Background" Value="Transparent" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource Window.StatusBar.Hover.Background}" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <Viewbox Height="15" Margin="-5,0,0,0">
                                <Path Data="M232 64c-30.928 0-56 25.072-56 56v784c0 30.928 25.072 56 56 56h560c30.928 0 56-25.072 56-56V120c0-30.928-25.072-56-56-56H232z m0 840V120h560v784H232z m112-736h-64v64h64V168z m168 120c-123.712 0-224 100.288-224 224s100.288 224 224 224 224-100.288 224-224-100.288-224-224-224z m-168 224c0-92.784 75.216-168 168-168s168 75.216 168 168-75.216 168-168 168-168-75.216-168-168z m168-112c-61.856 0-112 50.144-112 112s50.144 112 112 112 112-50.144 112-112-50.144-112-112-112zM744 168h-64v64h64V168zM316 792v56h392v-56H316z" Fill="{DynamicResource Window.Foreground}" />

                            </Viewbox>
                        </Border>
                        <Viewbox
                            Height="14"
                            Margin="3"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom">
                            <Path RenderTransformOrigin="0.5,0.5">
                                <Path.RenderTransform>
                                    <RotateTransform CenterX="0" CenterY="0" />
                                </Path.RenderTransform>
                                <Path.Style>
                                    <Style TargetType="Path">
                                        <Setter Property="Visibility" Value="Hidden" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Running, Source={x:Static local:App.ScanManager}}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation
                                                                RepeatBehavior="Forever"
                                                                Storyboard.TargetProperty="RenderTransform.Angle"
                                                                From="0"
                                                                To="360"
                                                                Duration="0:0:1" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation
                                                                Storyboard.TargetProperty="RenderTransform.Angle"
                                                                To="0"
                                                                Duration="0:0:0" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.ExitActions>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Fill" Value="{DynamicResource Common.HighLight.Deep.Background}" />
                                                <Setter Property="Data" Value="M171.292444 548.977778a337.464889 337.464889 0 0 1 210.488889-367.445334c111.616-43.52 231.992889-22.698667 317.212445 39.480889L626.460444 338.488889l325.233778-1.251556L835.470222 0l-59.562666 96.426667C650.353778 15.075556 479.175111-11.491556 329.272889 46.933333 121.628444 127.886222 2.048 337.351111 25.6 549.034667h145.635556zM852.764444 465.009778a337.464889 337.464889 0 0 1-210.488888 367.502222c-102.627556 39.992889-215.836444 24.917333-302.819556-29.013333l65.536-106.211556-349.752889-20.48L203.093333 1024l62.065778-100.465778c125.553778 81.351111 279.608889 102.001778 429.511111 43.52 207.644444-80.952889 327.224889-290.304 303.616-502.044444h-145.635555z" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Running, Source={x:Static local:App.ScanManager}}" Value="False">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Fill" Value="{DynamicResource Common.Status.Complete.Background}" />
                                                <Setter Property="Data" Value="M947.605 139.803c-15.766-15.763-39.836-14.107-57.1 0-133.71 109.263-541.798 419.618-541.798 419.618s-165.018-71.128-216.268-94.163c-20.338-9.14-41.328-15.766-57.101 0-15.763 15.763-15.763 41.326 0 57.087 0 0 242.992 244.252 244.157 245.415 8.052 8.052 18.652 11.867 29.212 11.693 10.554 0.175 21.154-3.64 29.211-11.693 1.159-1.163 427.18-428.238 569.686-570.87 15.759-15.772 15.768-41.324 0.001-57.087z m0 0" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Running, Source={x:Static local:App.ScanManager}}" Value="null">
                                                <Setter Property="Visibility" Value="Hidden" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                        </Viewbox>
                    </Grid>
                    <Grid>
                        <super:PathMsg
                            Name="downloadPathMsg"
                            MouseLeftButtonUp="ShowDownloadPopup"
                            MsgCount="{Binding RunningCount, Source={x:Static local:App.DownloadManager}, Mode=OneWay}"
                            Path="M942.545455 676.584727a34.909091 34.909091 0 0 1 34.90909 34.909091v139.636364c0 70.562909-57.437091 128-128 128h-674.90909a128.139636 128.139636 0 0 1-128-128v-139.636364a34.909091 34.909091 0 1 1 69.818181 0v139.636364c0 32.046545 26.088727 58.181818 58.181819 58.181818h674.90909c32.093091 0 58.181818-26.135273 58.181819-58.181818v-139.636364a34.909091 34.909091 0 0 1 34.909091-34.909091z m-455.214546 129.396364l-164.584727-164.561455a34.909091 34.909091 0 1 1 49.361454-49.361454l104.983273 104.96V81.454545a34.909091 34.909091 0 1 1 69.818182 0v615.563637l104.96-104.96a34.909091 34.909091 0 1 1 49.361454 49.361454l-164.538181 164.561455a34.792727 34.792727 0 0 1-24.669091 10.216727c-8.96 0-17.873455-3.397818-24.715637-10.216727z"
                            Style="{StaticResource NormalPathMsg}" />
                    </Grid>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</super:BaseWindow>
